---
title: "Graphs"
output: html_document
date: "2023-10-20"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(broom)

games_raw <- read_csv("games.csv")

games <- games_raw |>
  filter(SEASON %in% c(2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
                       2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018))

# wins long

wins_long <- games |>
  slice(rep(1:n(), each = 2)) |>
  mutate(
    Home = rep(c(0, 1), times = n()/2),
    Win = ifelse((Home == 1 & HOME_TEAM_WINS == 1) | (Home == 0 & HOME_TEAM_WINS == 0), 1, 0)
  ) |>
  select(Home, Win)

wins_fit <- lm(Win ~ Home, data = wins_long)
glance(wins_fit)

#pts regression

pts_long <- games |>
  select(PTS_home, PTS_away) |>
  na.omit() |>
  pivot_longer(
    cols = everything(),
    names_to = "Home",
    values_to = "PTS"
  ) |>
  mutate(Home = as.integer(Home == "PTS_home"))

pts_fit <- lm(PTS ~ Home, data = pts_long)
glance(pts_fit)

pts_table <- data.frame(
  Intercept = c("98.693"),
  Home = c("+3.014"),
  P_value = c("1.11e-135")
)

pts_table_formatted <- knitr::kable(pts_table, col.names = c("Average visiting team points", "Average home court points advantage", "P-value"))

save(pts_table_formatted, file = "pts_table_formatted.RData")

#box plot

pts_boxplot <- ggplot(pts_long, 
                        aes(x = factor(Home, labels = c("Visiting team", "Home team")), y = PTS)) +
  geom_boxplot(width = 0.5, position = position_dodge(width = 0.8)) +
  stat_summary(fun = "mean", geom = "text", aes(label = sprintf("%.3f", after_stat(y))),
               position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  labs(x = "", y = "Points scored") + 
  ggtitle("Home court points advantage in the NBA, 2004-2019") +
  coord_cartesian(ylim = c(0, max(pts_long$PTS) * 1.2)) 

save(pts_boxplot, file = "pts_boxplot.RData")

# home team win average

home_team_win_average <- mean(games$HOME_TEAM_WINS, na.rm = TRUE)

```
